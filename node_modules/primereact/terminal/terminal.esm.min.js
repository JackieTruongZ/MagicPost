import*as e from"react";import{PrimeReactContext as n}from"primereact/api";import{ComponentBase as t,useHandleStyle as r}from"primereact/componentbase";import{TerminalService as o}from"primereact/terminalservice";import{mergeProps as a,DomHandler as l,classNames as i}from"primereact/utils";function c(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function s(e){if(Array.isArray(e))return c(e)}function m(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function u(e,n){if(e){if("string"==typeof e)return c(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?c(e,n):void 0}}function p(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function f(e){return s(e)||m(e)||u(e)||p()}function d(e){if(Array.isArray(e))return e}function y(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var r,o,a,l,i=[],c=!0,s=!1;try{if(a=(t=t.call(e)).next,0===n){if(Object(t)!==t)return;c=!1}else for(;!(c=(r=a.call(t)).done)&&(i.push(r.value),i.length!==n);c=!0);}catch(e){s=!0,o=e}finally{try{if(!c&&null!=t.return&&(l=t.return(),Object(l)!==l))return}finally{if(s)throw o}}return i}}function v(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function h(e,n){return d(e)||y(e,n)||u(e,n)||v()}var g=t.extend({defaultProps:{__TYPE:"Terminal",id:null,style:null,className:null,welcomeMessage:null,prompt:null,children:void 0},css:{classes:{root:"p-terminal p-component",content:"p-terminal-content",container:"p-terminal-prompt-container",command:"p-terminal-command",commandText:"p-terminal-input",prompt:"p-terminal-prompt",response:"p-terminal-response"},styles:"\n@layer primereact {\n    .p-terminal {\n        height: 18rem;\n        overflow: auto;\n    }\n    \n    .p-terminal-prompt-container {\n        display: flex;\n        align-items: center;\n    }\n    \n    .p-terminal-input {\n        flex: 1 1 auto;\n        border: 0 none;\n        background-color: transparent;\n        color: inherit;\n        padding: 0;\n        outline: 0 none;\n    }\n    \n    .p-terminal-input::-ms-clear {\n        display: none;\n    }        \n}\n"}}),b=e.memo(e.forwardRef((function(t,c){var s=e.useContext(n),m=g.getProps(t,s),u=h(e.useState(""),2),p=u[0],d=u[1],y=h(e.useState([]),2),v=y[0],b=y[1],E=h(e.useState(0),2),w=E[0],x=E[1],S=h(e.useState(""),2),N=S[0],T=S[1],A=e.useRef(null),j=e.useRef(null),C=e.useRef(!1),I=g.setMetaData({props:m,state:{commandText:p,commands:v}}),M=I.ptm,k=I.cx;r(g.css.styles,I.isUnstyled,{name:"terminal"});var O=a({className:k("prompt")},M("prompt")),P=function(e){d(e.target.value)},R=function(e){switch(e.which||e.keyCode){case 38:if(v&&v.length){var n=w-1<0?v.length-1:w-1,t=v[n];x(n),d(t.text)}break;case 13:if(p){var r=f(v);r.push({text:p}),x((function(e){return e+1})),d(""),b(r),T(p),C.current=!0}}};e.useImperativeHandle(c,(function(){return{props:m,focus:function(){return l.focus(j.current)},getElement:function(){return A.current}}})),e.useEffect((function(){var e=function(e){if(v&&v.length>0){var n=f(v);n[n.length-1].response=e,b(n)}},n=function(){b([]),x(0)};return o.on("response",e),o.on("clear",n),function(){o.off("response",e),o.off("clear",n)}}),[v]),e.useEffect((function(){C.current&&(o.emit("command",N),C.current=!1),A.current.scrollTop=A.current.scrollHeight}));var _,D,H=function(n,t){var r=n.text,o=n.response,l=a({key:r+"_"+t},M("commands")),i=a({className:k("command")},M("command")),c=a({className:k("response")},M("response"));return e.createElement("div",l,e.createElement("span",O,m.prompt," "),e.createElement("span",i,r),e.createElement("div",c,o))},U=function(){if(m.welcomeMessage){var n=a(M("welcomeMessage"));return e.createElement("div",n,m.welcomeMessage)}return null}(),K=function(){var n=v.map(H),t=a({className:k("content")},M("content"));return e.createElement("div",t,n)}(),Y=(_=a({className:k("container")},M("container")),D=a({ref:j,value:p,type:"text",className:k("commandText"),autoComplete:"off",onChange:function(e){return P(e)},onKeyDown:function(e){return R(e)}},M("commandText")),e.createElement("div",_,e.createElement("span",O,m.prompt," "),e.createElement("input",D))),$=a({id:m.id,ref:A,className:i(m.className,k("root")),style:m.style,onClick:function(){l.focus(j.current)}},g.getOtherProps(m),M("root"));return e.createElement("div",$,U,K,Y)})));b.displayName="Terminal";export{b as Terminal};
